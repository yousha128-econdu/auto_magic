<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>GAC Reviewer Toolkit - Premium</title>
    
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <link rel="icon" type="image/png" href="favicon.png?v=6.0">
    <link rel="shortcut icon" type="image/png" href="favicon.png?v=6.0">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           ULTRA-PREMIUM THEME ARCHITECTURE
           ========================================= */
        :root {
            /* Light Theme (Clean, Minimal, Apple-like) */
            --bg-body: #F4F4F5;
            --bg-surface: #FFFFFF;
            --bg-surface-alt: #FAFAFA;
            --bg-input: #F4F4F5;
            
            --border-light: #E4E4E7;
            --border-focus: #3B82F6;
            
            --text-main: #18181B;
            --text-muted: #71717A;
            --text-heading: #09090B;
            
            --brand-primary: #0056b3;
            --brand-gradient: linear-gradient(135deg, #0056b3, #2563EB);
            
            --success: #10B981;
            --warning: #F59E0B;
            --danger: #EF4444;
            --quillbot: #49C35A;
            
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.04);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.05), 0 2px 4px -1px rgba(0,0,0,0.03);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.05), 0 4px 6px -2px rgba(0,0,0,0.03);
            --shadow-drawer: -10px 0 30px rgba(0,0,0,0.08);
            --shadow-drawer-left: 10px 0 30px rgba(0,0,0,0.08);

            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        [data-theme="dark"] {
            /* Dark Theme (Deep, Sleek, Vercel/Linear-inspired) */
            --bg-body: #09090B;
            --bg-surface: #121214;
            --bg-surface-alt: #18181B;
            --bg-input: #09090B;
            
            --border-light: #27272A;
            --border-focus: #38BDF8;
            
            --text-main: #E4E4E7;
            --text-muted: #A1A1AA;
            --text-heading: #FAFAFA;
            
            --brand-primary: #38BDF8;
            --brand-gradient: linear-gradient(135deg, #38BDF8, #0284C7);
            
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.3);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.4);
            --shadow-lg: 0 20px 25px -5px rgba(0,0,0,0.5);
            --shadow-drawer: -10px 0 30px rgba(0,0,0,0.8);
            --shadow-drawer-left: 10px 0 30px rgba(0,0,0,0.8);
        }

        /* GLOBALS */
        body {
            font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
            background-color: var(--bg-body);
            color: var(--text-main);
            margin: 0; 
            padding: 50px 20px;
            min-height: 100vh;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            letter-spacing: 0.2px;
            line-height: 1.7;
            transition: background-color 0.4s ease, color 0.4s ease;
        }

        * { box-sizing: border-box; }

        /* THEME TOGGLE */
        .theme-toggle {
            position: fixed; top: 30px; right: 30px;
            width: 48px; height: 48px; padding: 0;
            background: var(--bg-surface);
            border: 1px solid var(--border-light); 
            color: var(--text-main);
            border-radius: 50%; cursor: pointer;
            font-size: 20px; z-index: 1000;
            display: flex; justify-content: center; align-items: center;
            box-shadow: var(--shadow-md);
            transition: all 0.3s ease;
        }
        .theme-toggle:hover { transform: scale(1.1) rotate(15deg); border-color: var(--brand-primary); }
        [data-theme="dark"] .theme-toggle:hover { transform: scale(1.1) rotate(-15deg); }

        /* MAIN CONTAINER */
        .container { 
            max-width: 1000px; 
            margin: 0 auto; 
            background: var(--bg-surface); 
            border-radius: var(--radius-xl); 
            box-shadow: var(--shadow-lg); 
            border: 1px solid var(--border-light); 
            overflow: hidden; 
            transition: background-color 0.4s ease, border-color 0.4s ease;
        }
        
        /* HEADER SECTION */
        .header { 
            background: var(--bg-surface-alt); 
            padding: 50px 40px; 
            text-align: center; 
            border-bottom: 1px solid var(--border-light); 
        }
        .logo-wrapper {
            background: #ffffff; 
            padding: 10px; 
            border-radius: 8px; 
            display: inline-block; 
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
        }
        .logo-img { max-width: 200px; display: block; }
        .header h1 { 
            margin: 0; font-size: 34px; font-weight: 800; 
            color: var(--text-heading); letter-spacing: -0.5px; 
        }
        .header p { 
            margin: 10px 0 0; font-weight: 700; text-transform: uppercase; 
            letter-spacing: 2px; font-size: 12px; color: var(--text-muted); 
        }

        /* FETCH CONTROLS */
        .setup-grid { 
            padding: 35px 40px; 
            background: var(--bg-surface); 
            display: grid; 
            grid-template-columns: 1fr 120px 140px 140px; 
            gap: 15px; 
            align-items: flex-end; 
            border-bottom: 1px solid var(--border-light); 
        }
        .field-group label { 
            display: block; font-size: 12px; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 1px; 
            margin-bottom: 8px; color: var(--text-muted); 
        }
        input, select { 
            width: 100%; padding: 15px 18px; 
            border: 1px solid var(--border-light); 
            border-radius: var(--radius-md); font-size: 15px; 
            background: var(--bg-input); color: var(--text-main); 
            font-weight: 600; font-family: inherit; transition: all 0.2s; 
        }
        input:focus, select:focus { 
            border-color: var(--border-focus); outline: none; 
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.15); 
        }

        /* BUTTONS */
        .btn-primary { 
            background: var(--text-heading); color: var(--bg-surface); 
            border: none; padding: 15px; border-radius: var(--radius-md); 
            font-weight: 800; font-size: 14px; cursor: pointer; 
            transition: all 0.2s ease; text-transform: uppercase; letter-spacing: 1px; 
            width: 100%; font-family: inherit; 
        }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); opacity: 0.9; }

        .btn-download-draft { 
            background: var(--bg-surface-alt); color: var(--text-main); 
            border: 1px solid var(--border-light); padding: 15px; 
            border-radius: var(--radius-md); font-weight: 800; font-size: 14px; 
            cursor: pointer; transition: all 0.2s; text-transform: uppercase; 
            letter-spacing: 1px; width: 100%; font-family: inherit; 
        }
        .btn-download-draft:hover { border-color: var(--text-muted); transform: translateY(-2px); }

        /* CONTENT DISPLAY AREA */
        #displayArea { padding: 40px; }
        
        .animated-entry { animation: gentleFadeIn 0.5s ease forwards; }
        @keyframes gentleFadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* REAL SHEET TITLE BADGE */
        .sheet-status-badge {
            display: inline-flex; align-items: center; gap: 10px;
            background: var(--bg-surface-alt);
            border: 1px solid var(--border-light);
            padding: 8px 16px;
            border-radius: 50px;
            font-weight: 700; font-size: 13px;
            color: var(--text-muted);
            margin-bottom: 25px;
            box-shadow: var(--shadow-sm);
        }
        .live-dot {
            width: 10px; height: 10px;
            background: var(--success);
            border-radius: 50%;
            box-shadow: 0 0 8px var(--success);
            animation: pulse-dot 2s infinite;
        }
        @keyframes pulse-dot { 0% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(0.8); } 100% { opacity: 1; transform: scale(1); } }
        .sheet-title-text { color: var(--text-heading); }

        /* PREMIUM IMPACT CARDS */
        .impact-card { 
            background: var(--bg-surface); 
            border: 1px solid var(--border-light); 
            border-radius: var(--radius-lg); 
            margin-bottom: 25px; 
            box-shadow: var(--shadow-sm); 
            transition: all 0.3s ease; 
        }
        .impact-card:hover { border-color: var(--text-muted); box-shadow: var(--shadow-md); }
        
        .card-header { 
            background: var(--bg-surface-alt); 
            padding: 18px 25px; 
            border-bottom: 1px solid var(--border-light); 
            border-radius: var(--radius-lg) var(--radius-lg) 0 0;
        }
        .card-body { padding: 25px; }

        .card-label { 
            font-size: 15px; font-weight: 700; color: var(--text-heading); 
            margin: 0; line-height: 1.6; 
        }
        .card-label::before { 
            content: 'QUESTION'; display: block; font-size: 10px; 
            font-weight: 800; color: var(--text-muted); 
            text-transform: uppercase; letter-spacing: 2px; margin-bottom: 6px; 
        }
        
        .card-value { 
            font-size: 16px; line-height: 1.9; color: var(--text-main); 
            white-space: pre-wrap; font-weight: 400; 
        }
        .card-value a { 
            color: var(--brand-primary); text-decoration: none; 
            font-weight: 600; transition: 0.2s; 
        }
        .card-value a:hover { text-decoration: underline; }

        /* QUILLBOT COMPONENT */
        .auth-suite { 
            background: var(--bg-surface-alt); border: 1px solid var(--border-light); 
            border-left: 4px solid var(--quillbot); padding: 25px 35px; 
            border-radius: var(--radius-lg); margin: 10px 40px 40px 40px; 
            display: flex; align-items: center; justify-content: space-between; 
            display: none; 
        }
        .auth-text h3 { margin: 0 0 5px 0; color: var(--text-heading); font-size: 18px; font-weight: 800; }
        .auth-text p { margin: 0; color: var(--text-muted); font-size: 14px; }
        .btn-auth { 
            background: var(--quillbot); color: #ffffff; border: none; 
            padding: 12px 24px; border-radius: var(--radius-md); font-weight: 700; 
            font-size: 13px; cursor: pointer; transition: 0.2s; text-transform: uppercase; 
        }
        .btn-auth:hover { background: var(--quillbot-green-hover); }

        /* NAVIGATION BUTTONS */
        .nav-buttons { 
            display: flex; justify-content: space-between; 
            margin: 0 40px 40px 40px; padding-top: 30px; 
            border-top: 1px solid var(--border-light); display: none; 
        }
        .nav-btn { 
            background: var(--bg-surface); color: var(--text-heading); 
            border: 1px solid var(--border-light); padding: 14px 30px; 
            border-radius: var(--radius-md); font-weight: 700; cursor: pointer; 
            transition: all 0.2s; width: 48%; text-transform: uppercase; 
            font-size: 13px; letter-spacing: 1px; 
        }
        .nav-btn:hover { border-color: var(--text-heading); }

        /* EVALUATION BOARD */
        .eval-board { 
            padding: 0 40px 50px 40px; margin: 0; display: none; 
        }
        
        .progress-sticky { 
            position: sticky; top: 0; background: var(--bg-surface); 
            padding: 20px 0; z-index: 5; margin-bottom: 30px; 
            border-bottom: 1px solid var(--border-light);
            /* Glassmorphism effect */
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        [data-theme="dark"] .progress-sticky { background: rgba(18, 18, 20, 0.9); }
        
        .progress-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; }
        .progress-title { margin: 0; color: var(--text-heading); font-size: 20px; font-weight: 800; }
        
        /* Action buttons inside sticky header */
        .sticky-actions { display: flex; gap: 10px; align-items: center; }
        .btn-clear {
            background: transparent; color: var(--text-muted);
            border: 1px solid var(--border-light); padding: 6px 12px;
            border-radius: 8px; font-size: 12px; font-weight: 700;
            cursor: pointer; transition: 0.2s; text-transform: uppercase;
        }
        .btn-clear:hover { background: var(--danger); color: white; border-color: var(--danger); }
        .progress-count { font-size: 13px; font-weight: 800; color: var(--text-heading); background: var(--bg-input); padding: 6px 12px; border-radius: 8px; border: 1px solid var(--border-light); }
        
        .progress-track { width: 100%; height: 8px; background: var(--bg-input); border-radius: 10px; overflow: hidden; border: 1px solid var(--border-light); }
        .progress-fill { height: 100%; background: var(--text-heading); width: 0%; transition: width 0.4s ease; }

        .eval-category-title { 
            color: var(--text-heading); font-size: 16px; font-weight: 800; 
            text-transform: uppercase; letter-spacing: 1px; 
            margin: 40px 0 20px 0; padding-bottom: 10px; 
            border-bottom: 2px dashed var(--border-light); 
        }

        .eval-row { 
            background: var(--bg-surface-alt); border: 1px solid var(--border-light); 
            border-radius: var(--radius-lg); padding: 25px; margin-bottom: 15px; 
            display: flex; flex-direction: column; gap: 12px; transition: 0.2s;
        }
        .eval-row:hover { border-color: var(--text-muted); }
        .eval-q-text { font-size: 15px; font-weight: 600; color: var(--text-heading); line-height: 1.6; }
        
        .eval-input, .eval-textarea { 
            width: 100%; max-width: 500px; padding: 14px 18px; 
            border: 1px solid var(--border-light); border-radius: var(--radius-md); 
            font-size: 14px; background: var(--bg-surface); color: var(--text-main); 
        }
        .eval-textarea { max-width: 100%; height: 100px; resize: vertical; }

        .btn-copy { 
            background: var(--text-heading); color: var(--bg-surface); 
            border: none; padding: 18px; border-radius: var(--radius-md); 
            font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; 
            letter-spacing: 1px; margin-top: 30px; font-size: 14px; font-family: inherit; transition: 0.2s; 
        }
        .btn-copy:hover { transform: translateY(-2px); opacity: 0.9; }

        .btn-draft, .btn-pdf { 
            background: var(--bg-surface-alt); color: var(--text-heading); 
            border: 1px solid var(--border-light); padding: 18px; border-radius: var(--radius-md); 
            font-weight: 800; cursor: pointer; width: 100%; text-transform: uppercase; 
            letter-spacing: 1px; margin-top: 12px; font-size: 14px; font-family: inherit; transition: 0.2s; 
        }
        .btn-draft:hover, .btn-pdf:hover { border-color: var(--text-muted); }

        .btn-reward-anim { background: var(--success) !important; color: white !important; border-color: var(--success) !important; }

        .empty-state { text-align: center; padding: 60px 20px; color: var(--text-muted); }
        .empty-state h3 { font-size: 28px; color: var(--text-heading); margin-bottom: 10px; font-weight: 800; letter-spacing: -0.5px; }
        .empty-state p { font-size: 16px; line-height: 1.6; font-weight: 400; }
        .joyful-emoji { font-size: 48px; margin-bottom: 15px; display: block; }

        /* DRAWERS */
        .btn-toggle-rubric, .btn-toggle-ai { 
            position: fixed; top: 50%; transform: translateY(-50%); 
            background: var(--bg-surface); color: var(--text-heading); 
            border: 1px solid var(--border-light); padding: 15px 12px; 
            font-weight: 800; font-size: 12px; cursor: pointer; 
            z-index: 1000; transition: 0.2s; text-transform: uppercase; 
            letter-spacing: 1.5px; writing-mode: vertical-rl; text-orientation: mixed; 
            box-shadow: var(--shadow-md); font-family: inherit;
        }
        .btn-toggle-rubric { right: -1px; border-radius: 12px 0 0 12px; border-right: none; }
        .btn-toggle-ai { left: -1px; border-radius: 0 12px 12px 0; border-left: none; }
        .btn-toggle-rubric:hover { padding-right: 20px; background: var(--bg-surface-alt); }
        .btn-toggle-ai:hover { padding-left: 20px; background: var(--bg-surface-alt); }
        
        .rubric-panel, .ai-panel { 
            position: fixed; top: 0; width: 600px; height: 100vh; 
            background: var(--bg-surface); z-index: 1001; 
            transition: 0.4s cubic-bezier(0.16, 1, 0.3, 1); overflow-y: auto; 
        }
        .rubric-panel { right: -650px; border-left: 1px solid var(--border-light); box-shadow: var(--shadow-drawer); }
        .ai-panel { left: -650px; border-right: 1px solid var(--border-light); box-shadow: var(--shadow-drawer-left); }
        .rubric-panel.open { right: 0; }
        .ai-panel.open { left: 0; }

        .drawer-header { 
            background: var(--bg-surface-alt); padding: 30px; 
            position: sticky; top: 0; z-index: 10; display: flex; 
            justify-content: space-between; align-items: center; 
            border-bottom: 1px solid var(--border-light);
        }
        .drawer-header h2 { margin: 0; font-size: 18px; font-weight: 800; color: var(--text-heading); text-transform: uppercase; letter-spacing: 1px; }
        .close-drawer { background: none; border: none; color: var(--text-muted); font-size: 32px; cursor: pointer; transition: 0.2s; padding: 0; line-height: 1; }
        .close-drawer:hover { color: var(--text-heading); transform: scale(1.1); }
        
        .rubric-content { padding: 30px; color: var(--text-main); }
        .rubric-section { margin-bottom: 30px; border-bottom: 1px solid var(--border-light); padding-bottom: 20px; }
        .rubric-section h4 { color: var(--text-heading); font-size: 16px; margin: 0 0 20px 0; text-transform: uppercase; letter-spacing: 1px; font-weight: 800; }
        
        .rubric-rule { 
            background: var(--bg-surface-alt); padding: 20px; 
            border-radius: var(--radius-md); margin-bottom: 15px; 
            border: 1px solid var(--border-light); 
        }
        .rubric-rule p { margin: 0 0 10px 0; font-size: 14px; line-height: 1.7; }
        
        .score-badge { 
            font-weight: 800; padding: 4px 8px; border-radius: 6px; 
            display: inline-block; margin-right: 8px; color: var(--bg-surface); 
            font-size: 11px; text-transform: uppercase; letter-spacing: 1px; 
            background: var(--text-heading);
        }
        .s-yn { background: var(--text-muted); }

        .ai-table { width: 100%; border-collapse: collapse; font-size: 13px; margin-bottom: 20px; background: var(--bg-surface); }
        .ai-table th, .ai-table td { padding: 12px; border: 1px solid var(--border-light); text-align: left; line-height: 1.6; }
        .ai-table th { background: var(--bg-surface-alt); font-weight: 800; color: var(--text-heading); }

        /* FOOTER */
        .elegant-footer { max-width: 1000px; margin: 40px auto; text-align: center; }
        .elegant-footer-disclaimer { 
            background: var(--bg-surface); border: 1px solid var(--border-light); 
            padding: 25px; border-radius: var(--radius-lg); text-align: left; 
            font-size: 13px; color: var(--text-muted); line-height: 1.7; margin-bottom: 25px; 
        }
        .about-developer { 
            background: var(--bg-surface); border: 1px solid var(--border-light); 
            border-radius: var(--radius-lg); padding: 25px; 
        }
        .about-developer h4 { color: var(--text-heading); font-weight: 800; text-transform: uppercase; letter-spacing: 2px; font-size: 12px; margin: 0 0 15px 0; }
        .elegant-footer-links { display: flex; justify-content: center; gap: 20px; font-weight: 700; font-size: 13px; }
        .elegant-footer-links a { color: var(--text-muted); text-decoration: none; transition: 0.2s; }
        .elegant-footer-links a:hover { color: var(--text-heading); }

    </style>
</head>
<body>

<button class="theme-toggle" onclick="toggleTheme()" id="btnThemeToggle" title="Toggle Theme">
    <span id="themeIcon">üåô</span>
</button>

<button class="btn-toggle-ai" onclick="toggleAiPolicy()">AI Policy</button>
<div class="ai-panel" id="aiPanel">
    <div class="drawer-header">
        <h2>AI Policy Guide</h2>
        <button class="close-drawer" onclick="toggleAiPolicy()">√ó</button>
    </div>
    <div class="rubric-content">
        <div class="rubric-section ai-section">
            <div class="rubric-rule ai-rule">
                <p><strong>‚úÖ AI may be used as an editing tool.</strong> Correcting grammar, improving clarity, or adjusting structure.</p>
                <p><strong>‚ùå AI may not be used to generate substance.</strong> Developing project ideas, constructing arguments, or generating reflections is prohibited.</p>
            </div>
        </div>
        <div class="rubric-section ai-section">
            <h4>Red Flags vs Green Flags</h4>
            <table class="ai-table">
                <tr><th>Green Flags (Good)</th><th>Red Flags (Bad)</th></tr>
                <tr><td>Clear personal experiences & specifics</td><td>Repeated ideas using just different synonyms</td></tr>
                <tr><td>Concrete details & nuance</td><td>Overuse of broad, vague, abstract words</td></tr>
                <tr><td>Natural variation in tone</td><td>Highly polished but generic and uniform structure</td></tr>
            </table>
        </div>
    </div>
</div>

<button class="btn-toggle-rubric" onclick="toggleRubric()">Official Rubric</button>
<div class="rubric-panel" id="rubricPanel">
    <div class="drawer-header">
        <h2>Official Rubric</h2>
        <button class="close-drawer" onclick="toggleRubric()">√ó</button>
    </div>
    <div class="rubric-content">
        <div class="rubric-section">
            <h4>Part 1: Project Description</h4>
            <div class="rubric-rule">
                <p><span class="score-badge">5</span> Highly Clear: Problem relates to SDG, compelling response, simple language, no buzzwords.</p>
                <p><span class="score-badge">4</span> Clear: Relates to SDG, reasonable response, mostly simple language.</p>
                <p><span class="score-badge">1</span> Unclear: Fails to relate to SDG, vague, heavy jargon.</p>
            </div>
        </div>
        <div class="rubric-section">
            <h4>Part 2: Personal Motivation</h4>
            <div class="rubric-rule">
                <p><span class="score-badge">5</span> Highly Agree: Clear, compelling personal story explaining interest in social impact.</p>
                <p><span class="score-badge">3</span> Unsure: Mentions experiences but link to motivation is undeveloped.</p>
                <p><span class="score-badge">1</span> Disagree: No personal experiences or strictly resume-building focus.</p>
            </div>
        </div>
    </div>
</div>

<div class="container" id="pdfContentArea">
    
    <div class="header">
        <div class="logo-wrapper">
            <img src="logo.png.jpg" alt="MCN Logo" class="logo-img" onerror="this.style.display='none'; this.parentNode.innerText='Millennium Fellowship'; this.parentNode.style.fontWeight='800'; this.parentNode.style.color='#0056b3';">
        </div>
        <h1>Admissions Review Toolkit</h1>
        <p>Developed By Akhyear Mushfiqur Rahman ‚Ä¢ GAC'26</p>
    </div>

    <div class="setup-grid" id="setupGrid">
        <div class="field-group">
            <label>Master Datasheet Link</label>
            <input type="text" id="sheetLink" placeholder="Paste your Google Sheet link here...">
        </div>
        <div class="field-group">
            <label>Row No.</label>
            <input type="number" id="rowNum" value="2" min="2">
        </div>
        <button class="btn-primary" onclick="loadData()">Fetch Profile</button>
        <button class="btn-download-draft" onclick="downloadDraftCSV()">Draft CSV</button>
    </div>

    <div id="displayArea">
        <div class="empty-state">
            <span class="joyful-emoji">‚ú®</span>
            <h3>Ready for the next changemaker.</h3>
            <p>Paste the master sheet link above and fetch a row to begin your distraction-free evaluation session.</p>
        </div>
    </div>

    <div class="auth-suite" id="authSuite">
        <div class="auth-text">
            <h3>Authenticity Check</h3>
            <p>Instantly copy this application to check for AI usage.</p>
        </div>
        <button class="btn-auth" id="btnQuillbot" onclick="checkAuthenticity()">Open QuillBot ‚Üó</button>
    </div>

    <div class="nav-buttons" id="navButtons">
        <button class="nav-btn" onclick="changeRow(-1)">‚Üê Previous Applicant</button>
        <button class="nav-btn" onclick="changeRow(1)">Next Applicant ‚Üí</button>
    </div>

    <div class="eval-board" id="evalBoard">
        <div class="progress-sticky" id="progressSticky">
            <div class="progress-header">
                <h3 class="progress-title">Draft Assessment Board</h3>
                <div class="sticky-actions">
                    <button class="btn-clear" onclick="clearBoard()">Clear All</button>
                    <div class="progress-count"><span id="completedCount">0</span> / 28</div>
                </div>
            </div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div id="evalContainer"></div>
        
        <button class="btn-copy" onclick="copyScores()" id="btnCopyEval">Copy Scores to Clipboard</button>
        <button class="btn-draft" onclick="saveToDraft()" id="btnDraft">Export to Draft Memory</button>
        <button class="btn-pdf" onclick="saveAsPDF()" id="btnPdf">Save Profile as PDF</button>

        <div id="syncCenter" style="margin-top: 40px; padding-top: 30px; border-top: 1px solid var(--border-light);">
            <h4 style="color: var(--text-heading); font-size: 16px; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; margin-top: 0;">Automated Sheet Sync</h4>
            <p style="font-size: 13px; color: var(--text-muted); margin-bottom: 20px;">
                Paste your Google Apps Script Web App URL below to magically push your drafted scores directly into the blank dropdowns of your official sheet.
            </p>
            <div style="display: flex; gap: 15px;">
                <input type="text" id="webhookUrl" placeholder="Script URL ending in /exec..." style="flex: 1;">
                <button class="btn-primary" id="btnSync" onclick="syncToGoogleSheet()" style="width: auto; padding: 0 30px;">Push Data</button>
            </div>
        </div>
    </div>
</div>

<div class="elegant-footer">
    <div class="elegant-footer-disclaimer">
        <strong>‚ö†Ô∏è Important Notice:</strong> This toolkit is an independent, non-modifiable reading interface developed by an MCN Fellow. It strictly functions as a "read-only" magnifying glass to reduce eye strain. It cannot alter the master database without explicit permission via a custom Apps Script webhook.
    </div>
    <div class="about-developer">
        <h4>About the Developer</h4>
        <div class="elegant-footer-links">
            <a href="https://bd.linkedin.com/in/akhyear-mushfiqur-rahman" target="_blank">LinkedIn</a>
            <a href="https://www.millenniumfellows.org/fellow/2025/ud/akhyear-mushfiqur-rahman" target="_blank">MCN Profile</a>
        </div>
    </div>
</div>

<script>
// THEME TOGGLE LOGIC
function toggleTheme() {
    const body = document.body;
    if (body.getAttribute('data-theme') === 'dark') {
        body.removeAttribute('data-theme');
        localStorage.setItem('mcn_theme', 'light');
        document.getElementById('themeIcon').innerText = 'üåô';
    } else {
        body.setAttribute('data-theme', 'dark');
        localStorage.setItem('mcn_theme', 'dark');
        document.getElementById('themeIcon').innerText = '‚òÄÔ∏è';
    }
}

window.addEventListener('DOMContentLoaded', () => {
    if (localStorage.getItem('mcn_theme') === 'dark') {
        document.body.setAttribute('data-theme', 'dark');
        document.getElementById('themeIcon').innerText = '‚òÄÔ∏è';
    }
});

let currentFullText = "";
let currentApplicantName = "Applicant";

const questions = [
    "Student is leading or involved in a social impact organization, project, creative initiative, etc.",
    "Student's description of the project is clear, accessible and easy to understand",
    "Student presents clear and specific measurable goals and activities",
    "Project demonstrates potential for sustainability and/or scalability",
    "Student‚Äôs work is genuinely connected to one or more SDGs or UNAI Principles",
    "Student‚Äôs work will offer a contribution to the Fellowship cohort",
    "Student is close to the people they are trying to help (Proximity)",
    "Political nature of project: Is the work politically sensitive?",
    "Ethics of project: Does it seem unethical or paternalistic?",
    "Q1: Personal experiences shaping interest in social impact (Story)",
    "Q2: Why become a Millennium Fellow? Future use of distinction",
    "Q3: Reflection on acting as an empathetic, humble, inclusive leader",
    "Essay/video responses demonstrate emotional investment and passion",
    "Student has a genuine passion and personal connection to the work",
    "Articulates a clear vision for future social impact career/life",
    "Motivation for joining is related to their proposed project",
    "Demonstrates real commitment to the program requirements",
    "Clear understanding and willingness to participate in all aspects",
    "Does the applicant demonstrate a community mindset?",
    "Student is driven by values (empathy/humility) over personal importance",
    "Provides specific examples of demonstrating empathy and humility",
    "Ethics of person: Do responses lead you to question their ethics?",
    "Overall, do the responses seem AI-generated? (Option 1-4)",
    "Overall, does the applicant show ethical integrity?",
    "Your Overall Rating of the Applicant (1-10)",
    "Overall, what do you think about this applicant? (Final Decision)",
    "If you selected 'Reject this Applicant', please share why",
    "[Optional] Additional comments about this application"
];

const evalIds = []; 
for(let i=1; i<=28; i++) { evalIds.push('eval_' + i); }

const evalCont = document.getElementById('evalContainer');
questions.forEach((q, i) => {
    const num = i + 1;
    let inputHtml = "";
    
    if(num === 1) evalCont.innerHTML += `<div class="eval-category-title">Part 1: The Project & Impact</div>`;
    if(num === 8) evalCont.innerHTML += `<div class="eval-category-title">Part 2: Project Ethics</div>`;
    if(num === 10) evalCont.innerHTML += `<div class="eval-category-title">Part 3: The Leader & Values</div>`;
    if(num === 22) evalCont.innerHTML += `<div class="eval-category-title">Part 4: Authenticity & Integrity</div>`;
    if(num === 25) evalCont.innerHTML += `<div class="eval-category-title">Part 5: Final Verdict</div>`;

    if (num === 23) { 
        inputHtml = `<select id="eval_${num}" class="eval-input eval-tracker"><option value="">Select Option...</option><option value="Option 1">1. Yes, completely AI / unoriginal</option><option value="Option 2">2. Yes, majority AI / original ideas</option><option value="Option 3">3. Yes, short portion AI / original ideas</option><option value="Option 4">4. No, completely original no AI</option></select>`;
    } else if (num === 25) { 
        inputHtml = `<select id="eval_${num}" class="eval-input eval-tracker"><option value="">Select Rating...</option>${[10,9,8,7,6,5,4,3,2,1].map(n => `<option value="${n}">${n}</option>`).join('')}</select>`;
    } else if (num === 26) { 
        inputHtml = `<select id="eval_${num}" class="eval-input eval-tracker"><option value="">Select Decision...</option><option value="Accept">Accept</option><option value="Waitlist">Waitlist</option><option value="Reject">Reject</option></select>`;
    } else if (num === 8 || num === 9 || num === 22 || num === 24) { 
        inputHtml = `<select id="eval_${num}" class="eval-input eval-tracker"><option value="">Select...</option><option value="Yes">Yes</option><option value="Maybe">Maybe</option><option value="No">No</option></select>`;
    } else if (num >= 27) { 
        inputHtml = `<textarea id="eval_${num}" class="eval-textarea eval-tracker" placeholder="Type your notes here..."></textarea>`;
    } else { 
        inputHtml = `<select id="eval_${num}" class="eval-input eval-tracker"><option value="">Select Score...</option><option value="5">5 - Highly Agree</option><option value="4">4 - Agree</option><option value="3">3 - Neutral</option><option value="2">2 - Disagree</option><option value="1">1 - Highly Disagree</option></select>`;
    }

    evalCont.innerHTML += `<div class="eval-row"><div class="eval-q-text">${num}. ${q}</div>${inputHtml}</div>`;
});

function updateProgress() {
    let filled = 0;
    document.querySelectorAll('.eval-tracker').forEach(el => {
        if (el.value.trim() !== "") filled++;
    });
    document.getElementById('completedCount').innerText = filled;
    document.getElementById('progressFill').style.width = (filled / 28 * 100) + '%';
}

document.querySelectorAll('.eval-tracker').forEach(item => {
    item.addEventListener('change', function() { updateProgress(); });
});

function clearBoard() {
    document.querySelectorAll('.eval-tracker').forEach(el => el.value = "");
    updateProgress();
}

function toggleRubric() { document.getElementById('rubricPanel').classList.toggle('open'); }
function toggleAiPolicy() { document.getElementById('aiPanel').classList.toggle('open'); }

function formatText(str) {
    if (!str) return "";
    const alphaStr = str.replace(/[^A-Za-z]/g, '');
    if (alphaStr.length > 0 && alphaStr === alphaStr.toUpperCase()) {
        let lower = str.toLowerCase();
        return lower.replace(/(^\s*\w|[.!?]\s*\w)/g, c => c.toUpperCase());
    }
    return str;
}

// REAL SHEET TITLE EXTRACTOR API
async function fetchSheetTitle(url) {
    try {
        const baseUrlMatch = url.match(/(https:\/\/docs\.google\.com\/spreadsheets\/d\/[a-zA-Z0-9-_]+)/);
        if (!baseUrlMatch) return "Unknown Database format";
        
        // Use a public proxy to bypass Google's HTML block
        const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(baseUrlMatch[1])}`;
        const response = await fetch(proxyUrl);
        const data = await response.json();
        
        const titleMatch = data.contents.match(/<title>(.*?)<\/title>/i);
        if (titleMatch && titleMatch[1]) {
            return titleMatch[1].replace(' - Google Sheets', '').trim();
        }
    } catch(e) { console.warn("Could not fetch title via proxy."); }
    
    // Fallback if the sheet is strictly private
    return "Private Google Sheet";
}

function loadData() {
    let link = document.getElementById('sheetLink').value.trim();
    const rowInput = document.getElementById('rowNum');
    const row = parseInt(rowInput.value);
    const output = document.getElementById('displayArea');
    
    document.getElementById('authSuite').style.display = "none";
    document.getElementById('navButtons').style.display = "none";
    document.getElementById('evalBoard').style.display = "none";
    clearBoard();

    if (!link) {
        output.innerHTML = "<div class='empty-state animated-entry'><span class='joyful-emoji'>üîç</span><h3>Missing Link</h3><p>Please paste your master datasheet link first.</p></div>";
        return;
    }

    if (link.includes('/edit')) { link = link.split('/edit')[0] + '/export?format=csv'; }

    output.innerHTML = "<div class='empty-state animated-entry'><span class='joyful-emoji'>üîÑ</span><h3>Fetching Records...</h3><p>Gathering candidate details securely.</p></div>";

    Papa.parse(link, {
        download: true,
        header: true,
        complete: function(results) {
            const data = results.data;
            const index = row - 2;

            if (index < 0 || index >= data.length) {
                output.innerHTML = "<div class='empty-state animated-entry'><span class='joyful-emoji'>üèÅ</span><h3>End of the Line!</h3><p>Candidate row does not exist or the row is completely empty.</p></div>";
                document.getElementById('navButtons').style.display = "flex";
                return;
            }

            const student = data[index];
            currentFullText = ""; 
            const firstName = student["First Name"] || "Unknown";
            const lastName = student["Last Name"] || "Candidate";
            currentApplicantName = (firstName + "_" + lastName).trim();

            let html = `
                <div class='animated-entry'>
                    <div class='sheet-status-badge' title='Securely verified via proxy'>
                        <span class='live-dot'></span> 
                        <span>Connected: <span id='sheetTitleText' class='sheet-title-text'>Fetching name...</span></span>
                    </div>
                    <h2 style='color:var(--text-heading); margin-bottom: 30px; font-weight: 800; font-size: 28px;'>Applicant Profile</h2>
            `;

            for (const key in student) {
                if (student[key] && student[key].trim() !== "") {
                    let contentText = student[key];
                    const linkFinder = /(https?:\/\/[^\s]+)/g;
                    contentText = contentText.replace(linkFinder, '<a href="$1" target="_blank" title="Click to open link">$1</a>');
                    let formattedQuestion = formatText(key);

                    html += `<div class="impact-card">
                                <div class="card-header"><h4 class="card-label">${formattedQuestion}</h4></div>
                                <div class="card-body"><div class="card-value">${contentText}</div></div>
                             </div>`;
                    
                    currentFullText += key + ":\n" + student[key] + "\n\n";
                }
            }
            html += "</div>";
            output.innerHTML = html;
            
            // Trigger background title fetch
            fetchSheetTitle(document.getElementById('sheetLink').value).then(title => {
                const titleEl = document.getElementById('sheetTitleText');
                if(titleEl) titleEl.innerText = title;
            });

            document.getElementById('authSuite').style.display = "flex";
            document.getElementById('navButtons').style.display = "flex";
            document.getElementById('evalBoard').style.display = "block";
            document.getElementById('btnQuillbot').innerText = "Open QuillBot ‚Üó";
            document.getElementById('btnCopyEval').innerText = "Copy Scores to Clipboard";
        }
    });
}

function checkAuthenticity() {
    const btn = document.getElementById('btnQuillbot');
    navigator.clipboard.writeText(currentFullText).then(() => {
        btn.innerText = "Copied! Opening...";
        setTimeout(() => {
            window.open('https://quillbot.com/ai-content-detector', '_blank');
            btn.innerText = "Open QuillBot ‚Üó";
        }, 800);
    });
}

function changeRow(step) {
    const rowBox = document.getElementById('rowNum');
    let newRow = parseInt(rowBox.value) + step;
    if (newRow < 2) newRow = 2;
    rowBox.value = newRow;
    loadData();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function copyScores() {
    const btn = document.getElementById('btnCopyEval');
    let values = evalIds.map(id => document.getElementById(id).value.replace(/\n/g, " "));
    navigator.clipboard.writeText(values.join("\t")).then(() => {
        btn.innerText = "‚úì Copied to Clipboard";
        btn.classList.add('btn-reward-anim');
        setTimeout(() => {
            btn.innerText = "Copy Scores to Clipboard";
            btn.classList.remove('btn-reward-anim');
        }, 2000);
    });
}

function saveToDraft() {
    const row = document.getElementById('rowNum').value;
    const btn = document.getElementById('btnDraft');
    let values = evalIds.map(id => document.getElementById(id).value.replace(/\n/g, " "));
    let drafts = JSON.parse(localStorage.getItem('mcn_eval_drafts')) || {};
    drafts[row] = { name: currentApplicantName, scores: values };
    localStorage.setItem('mcn_eval_drafts', JSON.stringify(drafts));

    btn.innerText = "‚úì Saved to Memory";
    btn.classList.add('btn-reward-anim');
    setTimeout(() => {
        btn.innerText = "Export to Draft Memory";
        btn.classList.remove('btn-reward-anim');
    }, 2000);
}

function downloadDraftCSV() {
    let drafts = JSON.parse(localStorage.getItem('mcn_eval_drafts')) || {};
    let rows = Object.keys(drafts).sort((a, b) => parseInt(a) - parseInt(b));
    if (rows.length === 0) return alert("Your memory is empty. Save an evaluation first.");

    let csvContent = "Row,Name," + Array.from({length: 28}, (_, i) => `Q${i+1}`).join(",") + "\n";
    rows.forEach(row => {
        let d = drafts[row];
        csvContent += `${row},"${d.name}",${d.scores.map(v => `"${v}"`).join(",")}\n`;
    });

    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const link = document.createElement("a");
    link.href = URL.createObjectURL(blob);
    link.download = "GAC_Evaluations.csv";
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

function saveAsPDF() {
    const btnPdf = document.getElementById('btnPdf');
    btnPdf.innerText = "Scanning... Please Wait";
    
    document.getElementById('setupGrid').style.display = 'none';
    document.getElementById('authSuite').style.display = 'none';
    document.getElementById('navButtons').style.display = 'none';
    document.getElementById('btnCopyEval').style.display = 'none';
    document.getElementById('btnDraft').style.display = 'none';
    document.getElementById('btnThemeToggle').style.display = 'none';
    document.getElementById('syncCenter').style.display = 'none';
    document.querySelector('.sticky-actions').style.display = 'none';
    btnPdf.style.display = 'none';

    const element = document.getElementById('pdfContentArea');
    const originalBackground = element.style.background;
    element.style.background = '#ffffff'; 

    html2pdf().set({
        margin: 0.4, filename: currentApplicantName + '_Profile.pdf',
        image: { type: 'jpeg', quality: 1.0 },
        html2canvas: { scale: 2, useCORS: true },
        jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
    }).from(element).save().then(() => {
        element.style.background = originalBackground;
        document.getElementById('setupGrid').style.display = 'grid';
        document.getElementById('authSuite').style.display = 'flex';
        document.getElementById('navButtons').style.display = 'flex';
        document.getElementById('btnCopyEval').style.display = 'block';
        document.getElementById('btnDraft').style.display = 'block';
        document.getElementById('btnThemeToggle').style.display = 'flex';
        document.getElementById('syncCenter').style.display = 'block';
        document.querySelector('.sticky-actions').style.display = 'flex';
        btnPdf.style.display = 'block';
        btnPdf.innerText = "Save Profile as PDF";
    });
}

async function syncToGoogleSheet() {
    const webhookUrl = document.getElementById('webhookUrl').value.trim();
    const btn = document.getElementById('btnSync');
    let drafts = JSON.parse(localStorage.getItem('mcn_eval_drafts')) || {};

    if (Object.keys(drafts).length === 0) return alert("Draft memory empty!");
    if (!webhookUrl) return alert("Paste your App Script URL.");

    btn.innerText = "Pushing..."; btn.style.opacity = "0.7";

    try {
        await fetch(webhookUrl, {
            method: 'POST', mode: 'no-cors',
            headers: { 'Content-Type': 'text/plain;charset=utf-8' },
            body: JSON.stringify(drafts)
        });

        btn.innerText = "‚úì Pushed!";
        btn.classList.add('btn-reward-anim');
        localStorage.removeItem('mcn_eval_drafts');
        
        setTimeout(() => {
            btn.innerText = "Push Data"; btn.style.opacity = "1";
            btn.classList.remove('btn-reward-anim');
        }, 3000);
    } catch (e) {
        btn.innerText = "‚ùå Failed";
        setTimeout(() => { btn.innerText = "Push Data"; btn.style.opacity = "1"; }, 3000);
    }
}
</script>

</body>
</html>
